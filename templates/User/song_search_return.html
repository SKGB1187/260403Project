{% extends 'base.html' %}

{% block body_class %}onboarding{% endblock %}

{% block content %}

{% if song %}
<div class="search-results">
    <h2>Search Results:</h2>
    <table class="table table-striped table-dark text-success table-hover">
        <thead>
            <tr>
                <th scope="col">Song Title</th>
                <th scope="col">Artist</th>
                <th scope="col">User Playlists</th>
                <th scope="col">Add Song</th>
            </tr>
        </thead>
        <tbody>
            {% for track in song['tracks']['items'] %}
            <tr>
                <th><strong>{{ track['name'] }}</strong></th> 
                <th> {{ track['artists'][0]['name'] }} </th>
                <th>
                    <select class="form-select bg-success text-dark" id="playlist-{{ loop.index }}">
                        {% for playlist in playlists %}
                        <option value="{{ playlist.id }}">{{ playlist.name }}</option>
                        {% endfor %}
                    </select>
                </th>
                <th> 
                <button class="btn btn-success text-dark"
                    onclick="addToPlaylist('{{ track['id'] }}', document.getElementById('playlist-{{ loop.index }}').value)">Add
                    to Playlist</button>
                </th>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<script>
    function addToPlaylist(songId, playlistId) {
      fetch(`/add_to_playlist?song_id=${songId}&playlist_id=${playlistId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      }).then(response => {
        if (response.ok) {
          alert('Song added to playlist successfully!');
        } else {
          alert('Failed to add song to playlist.');
        }
      });
    }
  </script>
{% endblock %}